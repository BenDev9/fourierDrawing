class Cycle {
    freq; // Frequency
    amp; // Amplitude (length)
    phase; // Phase (starting angle)
    constructor(_freq, _amp, _phase) {
        this.freq = _freq;
        this.amp = _amp;
        this.phase = _phase;
    }
}

class Complex {
    constructor(a, b) {
        this.re = a;
        this.im = b;
    }

    add(c) {
        this.re += c.re;
        this.im += c.im;
    }

    mult(c) {
        const re = this.re * c.re - this.im * c.im;
        const im = this.re * c.im + this.im * c.re;
        return new Complex(re, im);
    }
}

window.images = [
    {
        name: "Rabbit",
        data: [
            [
                85.88499450683594,
                -45.32600402832031
            ],
            [
                83.37212371826172,
                -49.641273498535156
            ],
            [
                80.54660034179688,
                -53.76084899902344
            ],
            [
                77.55552673339844,
                -57.762229919433594
            ],
            [
                74.45211791992188,
                -61.677276611328125
            ],
            [
                71.26221466064453,
                -65.5222053527832
            ],
            [
                67.9990463256836,
                -69.3051986694336
            ],
            [
                64.66943359375,
                -73.02985000610352
            ],
            [
                61.275733947753906,
                -76.69618225097656
            ],
            [
                57.816368103027344,
                -80.30062484741211
            ],
            [
                54.285797119140625,
                -83.83529281616211
            ],
            [
                50.67255401611328,
                -87.2853775024414
            ],
            [
                46.95521545410156,
                -90.62281799316406
            ],
            [
                43.090728759765625,
                -93.78805923461914
            ],
            [
                38.97071838378906,
                -96.6076774597168
            ],
            [
                36.559654235839844,
                -99.73579406738281
            ],
            [
                37.81346893310547,
                -104.57121467590332
            ],
            [
                38.793174743652344,
                -109.46951484680176
            ],
            [
                39.49247741699219,
                -114.41562843322754
            ],
            [
                39.90782928466797,
                -119.39363098144531
            ],
            [
                40.038543701171875,
                -124.38721466064453
            ],
            [
                39.88178253173828,
                -129.38001441955566
            ],
            [
                39.420082092285156,
                -134.3537769317627
            ],
            [
                38.63298034667969,
                -139.28640365600586
            ],
            [
                37.502166748046875,
                -144.15159606933594
            ],
            [
                36.01244354248047,
                -148.9190216064453
            ],
            [
                34.152366638183594,
                -153.55436515808105
            ],
            [
                31.914840698242188,
                -158.01960372924805
            ],
            [
                29.29638671875,
                -162.27246856689453
            ],
            [
                26.294395446777344,
                -166.26350116729736
            ],
            [
                22.89641571044922,
                -169.92237186431885
            ],
            [
                19.111557006835938,
                -171.08061695098877
            ],
            [
                15.671371459960938,
                -167.4618377685547
            ],
            [
                12.625595092773438,
                -163.503981590271
            ],
            [
                9.947608947753906,
                -159.28820419311523
            ],
            [
                7.632423400878906,
                -154.86262226104736
            ],
            [
                5.678092956542969,
                -150.26613426208496
            ],
            [
                4.081184387207031,
                -145.5334701538086
            ],
            [
                2.8348312377929688,
                -140.696533203125
            ],
            [
                1.9287796020507812,
                -135.78436851501465
            ],
            [
                1.3491134643554688,
                -130.82298278808594
            ],
            [
                1.0793991088867188,
                -125.83504104614258
            ],
            [
                1.1022186279296875,
                -120.83980941772461
            ],
            [
                1.4116897583007812,
                -115.85412216186523
            ],
            [
                2.0060501098632812,
                -110.8942928314209
            ],
            [
                2.8817291259765625,
                -105.97632598876953
            ],
            [
                4.032249450683594,
                -101.11527633666992
            ],
            [
                1.0239639282226562,
                -98.82204055786133
            ],
            [
                -2.140533447265625,
                -99.93925857543945
            ],
            [
                -3.3983078002929688,
                -104.77369499206543
            ],
            [
                -4.9238739013671875,
                -109.53034591674805
            ],
            [
                -6.715789794921875,
                -114.19321250915527
            ],
            [
                -8.7701416015625,
                -118.74654197692871
            ],
            [
                -11.08111572265625,
                -123.17512512207031
            ],
            [
                -13.640609741210938,
                -127.46492004394531
            ],
            [
                -16.44412612915039,
                -131.59925842285156
            ],
            [
                -19.49722671508789,
                -135.5527458190918
            ],
            [
                -22.804946899414062,
                -139.29561042785645
            ],
            [
                -26.368408203125,
                -142.7956714630127
            ],
            [
                -30.18399429321289,
                -146.01884269714355
            ],
            [
                -34.24248123168945,
                -148.92998504638672
            ],
            [
                -38.529335021972656,
                -151.49273490905762
            ],
            [
                -43.02429962158203,
                -153.66942977905273
            ],
            [
                -47.703216552734375,
                -155.41523456573486
            ],
            [
                -52.5392951965332,
                -156.657865524292
            ],
            [
                -55.93821334838867,
                -154.95654106140137
            ],
            [
                -56.87483215332031,
                -150.05186080932617
            ],
            [
                -57.310211181640625,
                -145.07670211791992
            ],
            [
                -57.30159378051758,
                -140.08223152160645
            ],
            [
                -56.876983642578125,
                -135.10570526123047
            ],
            [
                -56.058204650878906,
                -130.178560256958
            ],
            [
                -54.866817474365234,
                -125.32789039611816
            ],
            [
                -53.32551574707031,
                -120.57672691345215
            ],
            [
                -51.45872116088867,
                -115.9436206817627
            ],
            [
                -49.29203414916992,
                -111.4428825378418
            ],
            [
                -46.85123825073242,
                -107.08456611633301
            ],
            [
                -44.161075592041016,
                -102.87550354003906
            ],
            [
                -41.235050201416016,
                -98.82682418823242
            ],
            [
                -38.08287811279297,
                -94.9516716003418
            ],
            [
                -34.715545654296875,
                -91.26198196411133
            ],
            [
                -31.14559555053711,
                -87.76782608032227
            ],
            [
                -27.386554718017578,
                -84.4780158996582
            ],
            [
                -23.452167510986328,
                -81.39992141723633
            ],
            [
                -19.634967803955078,
                -78.449462890625
            ],
            [
                -21.103050231933594,
                -73.67644119262695
            ],
            [
                -24.063705444335938,
                -73.7099723815918
            ],
            [
                -28.23077392578125,
                -76.46486282348633
            ],
            [
                -32.53756332397461,
                -78.99594116210938
            ],
            [
                -36.970008850097656,
                -81.29979705810547
            ],
            [
                -41.514869689941406,
                -83.3731575012207
            ],
            [
                -46.15888214111328,
                -85.21368789672852
            ],
            [
                -50.88927459716797,
                -86.81933975219727
            ],
            [
                -55.6934700012207,
                -88.18863677978516
            ],
            [
                -60.559085845947266,
                -89.32036590576172
            ],
            [
                -65.47391128540039,
                -90.2143783569336
            ],
            [
                -70.42611312866211,
                -90.87073135375977
            ],
            [
                -75.40394973754883,
                -91.29019165039062
            ],
            [
                -80.39613723754883,
                -91.47425842285156
            ],
            [
                -85.39141464233398,
                -91.42492294311523
            ],
            [
                -90.37895584106445,
                -91.1419906616211
            ],
            [
                -95.34743118286133,
                -90.62331008911133
            ],
            [
                -100.28543090820312,
                -89.8675308227539
            ],
            [
                -105.18125915527344,
                -88.87443542480469
            ],
            [
                -110.0226993560791,
                -87.64345169067383
            ],
            [
                -114.79765510559082,
                -86.17565536499023
            ],
            [
                -119.49354362487793,
                -84.4718132019043
            ],
            [
                -124.09762191772461,
                -82.53349304199219
            ],
            [
                -128.5969352722168,
                -80.36301803588867
            ],
            [
                -132.97804832458496,
                -77.96306610107422
            ],
            [
                -137.22728538513184,
                -75.33661270141602
            ],
            [
                -141.3304443359375,
                -72.48751449584961
            ],
            [
                -145.27323150634766,
                -69.42024612426758
            ],
            [
                -149.04044914245605,
                -66.13972854614258
            ],
            [
                -152.61672496795654,
                -62.65215301513672
            ],
            [
                -155.9860258102417,
                -58.964237213134766
            ],
            [
                -159.13243865966797,
                -55.084495544433594
            ],
            [
                -162.03924083709717,
                -51.02216339111328
            ],
            [
                -164.69007873535156,
                -46.78836441040039
            ],
            [
                -167.06894493103027,
                -42.39603042602539
            ],
            [
                -170.36218547821045,
                -41.32857131958008
            ],
            [
                -175.24697303771973,
                -42.1905517578125
            ],
            [
                -180.04332494735718,
                -40.942481994628906
            ],
            [
                -183.9205503463745,
                -37.84457778930664
            ],
            [
                -186.33817195892334,
                -33.507381439208984
            ],
            [
                -186.9225401878357,
                -28.57910919189453
            ],
            [
                -185.55042219161987,
                -23.808319091796875
            ],
            [
                -182.48571872711182,
                -19.901580810546875
            ],
            [
                -178.15152502059937,
                -17.489978790283203
            ],
            [
                -175.08124542236328,
                -15.454486846923828
            ],
            [
                -176.05329942703247,
                -10.5579833984375
            ],
            [
                -176.5186676979065,
                -5.583900451660156
            ],
            [
                -176.86974954605103,
                -0.6003189086914062
            ],
            [
                -177.12253522872925,
                4.389190673828125
            ],
            [
                -177.27813911437988,
                9.382659912109375
            ],
            [
                -177.3317461013794,
                14.378280639648438
            ],
            [
                -177.27676725387573,
                19.37383270263672
            ],
            [
                -177.10123491287231,
                24.366661071777344
            ],
            [
                -176.79112148284912,
                29.352828979492188
            ],
            [
                -176.32750988006592,
                34.327003479003906
            ],
            [
                -175.68548774719238,
                39.28124237060547
            ],
            [
                -174.83194732666016,
                44.203277587890625
            ],
            [
                -173.72210502624512,
                49.07379150390625
            ],
            [
                -172.2947177886963,
                53.86030578613281
            ],
            [
                -170.46492195129395,
                58.506996154785156
            ],
            [
                -168.11701774597168,
                62.9127197265625
            ],
            [
                -165.10795974731445,
                66.89192199707031
            ],
            [
                -161.32049179077148,
                70.13043975830078
            ],
            [
                -156.80804920196533,
                72.23395538330078
            ],
            [
                -151.88549613952637,
                72.99430084228516
            ],
            [
                -146.8894920349121,
                73
            ],
            [
                -141.89350509643555,
                73
            ],
            [
                -136.8974723815918,
                73
            ],
            [
                -131.90148544311523,
                73
            ],
            [
                -126.90549850463867,
                73
            ],
            [
                -121.90946578979492,
                73
            ],
            [
                -116.91352462768555,
                73
            ],
            [
                -111.9174919128418,
                73
            ],
            [
                -106.92155075073242,
                73
            ],
            [
                -101.92551803588867,
                73
            ],
            [
                -96.92948532104492,
                73
            ],
            [
                -91.93354415893555,
                73
            ],
            [
                -86.9375114440918,
                73
            ],
            [
                -81.94157028198242,
                73
            ],
            [
                -76.94553756713867,
                73
            ],
            [
                -71.94950485229492,
                73
            ],
            [
                -66.95356369018555,
                73
            ],
            [
                -61.9575309753418,
                73
            ],
            [
                -59.29220199584961,
                70.87041473388672
            ],
            [
                -61.09201431274414,
                66.24512481689453
            ],
            [
                -64.41256332397461,
                62.539024353027344
            ],
            [
                -68.56523513793945,
                59.776878356933594
            ],
            [
                -73.12131118774414,
                57.736053466796875
            ],
            [
                -77.88156127929688,
                56.225982666015625
            ],
            [
                -82.75268173217773,
                55.12096405029297
            ],
            [
                -87.68683624267578,
                54.34233093261719
            ],
            [
                -92.65708541870117,
                53.842201232910156
            ],
            [
                -97.64650344848633,
                53.594940185546875
            ],
            [
                -99.90946960449219,
                53.02703857421875
            ],
            [
                -95.3977279663086,
                50.88440704345703
            ],
            [
                -91.07281112670898,
                48.38604736328125
            ],
            [
                -86.96259689331055,
                45.54834747314453
            ],
            [
                -83.09314346313477,
                42.390235900878906
            ],
            [
                -79.48945617675781,
                38.931968688964844
            ],
            [
                -76.17524719238281,
                35.1953125
            ],
            [
                -73.17267227172852,
                31.2039794921875
            ],
            [
                -70.50260543823242,
                26.98296356201172
            ],
            [
                -68.18414688110352,
                22.559112548828125
            ],
            [
                -66.23385620117188,
                17.961036682128906
            ],
            [
                -64.66577529907227,
                13.218971252441406
            ],
            [
                -63.49052429199219,
                8.364501953125
            ],
            [
                -62.71426010131836,
                3.4307022094726562
            ],
            [
                -62.33896255493164,
                -1.5498580932617188
            ],
            [
                -62.361610412597656,
                -6.544471740722656
            ],
            [
                -62.78266143798828,
                -11.521347045898438
            ],
            [
                -63.60396957397461,
                -16.448028564453125
            ],
            [
                -64.82294845581055,
                -21.29159164428711
            ],
            [
                -66.4326286315918,
                -26.019683837890625
            ],
            [
                -68.42218399047852,
                -30.600879669189453
            ],
            [
                -70.77711486816406,
                -35.00545883178711
            ],
            [
                -73.48123931884766,
                -39.20486831665039
            ],
            [
                -76.51509094238281,
                -43.172420501708984
            ],
            [
                -79.85831069946289,
                -46.88307571411133
            ],
            [
                -83.48902893066406,
                -50.31296157836914
            ],
            [
                -87.3835220336914,
                -53.44021987915039
            ],
            [
                -91.51705932617188,
                -56.243896484375
            ],
            [
                -95.86320495605469,
                -58.7048454284668
            ],
            [
                -100.39435577392578,
                -60.806060791015625
            ],
            [
                -105.08098602294922,
                -62.532779693603516
            ],
            [
                -109.89236831665039,
                -63.87328338623047
            ],
            [
                -114.79656219482422,
                -64.81937789916992
            ],
            [
                -119.07293891906738,
                -65.36759567260742
            ],
            [
                -114.080322265625,
                -65.51338195800781
            ],
            [
                -109.09175682067871,
                -65.26942825317383
            ],
            [
                -104.13873672485352,
                -64.6257209777832
            ],
            [
                -99.25404357910156,
                -63.583072662353516
            ],
            [
                -94.47051620483398,
                -62.146827697753906
            ],
            [
                -89.81952285766602,
                -60.32608413696289
            ],
            [
                -85.33171081542969,
                -58.13394546508789
            ],
            [
                -81.03596496582031,
                -55.58584976196289
            ],
            [
                -76.95954513549805,
                -52.6996955871582
            ],
            [
                -73.12833786010742,
                -49.49532699584961
            ],
            [
                -69.56653594970703,
                -45.99390411376953
            ],
            [
                -66.29700469970703,
                -42.21812057495117
            ],
            [
                -63.34125900268555,
                -38.1918830871582
            ],
            [
                -60.719337463378906,
                -33.94076919555664
            ],
            [
                -58.4495735168457,
                -29.49175262451172
            ],
            [
                -56.54798889160156,
                -24.873306274414062
            ],
            [
                -55.02800750732422,
                -20.115585327148438
            ],
            [
                -53.899757385253906,
                -15.250072479248047
            ],
            [
                -53.16947555541992,
                -10.30910873413086
            ],
            [
                -52.83883285522461,
                -5.325469970703125
            ],
            [
                -52.896934509277344,
                -0.3308563232421875
            ],
            [
                -53.32516098022461,
                4.64544677734375
            ],
            [
                -54.14064407348633,
                9.573043823242188
            ],
            [
                -55.358123779296875,
                14.417030334472656
            ],
            [
                -56.986480712890625,
                19.138450622558594
            ],
            [
                -59.02659606933594,
                23.697044372558594
            ],
            [
                -61.470882415771484,
                28.05218505859375
            ],
            [
                -64.30280303955078,
                32.16596984863281
            ],
            [
                -67.49779891967773,
                36.004547119140625
            ],
            [
                -71.02515411376953,
                39.54017639160156
            ],
            [
                -74.84919738769531,
                42.752830505371094
            ],
            [
                -78.93243789672852,
                45.629119873046875
            ],
            [
                -83.23669815063477,
                48.16277313232422
            ],
            [
                -87.72549438476562,
                50.353515625
            ],
            [
                -87.50100708007812,
                51.32786560058594
            ],
            [
                -82.51190948486328,
                51.57677459716797
            ],
            [
                -77.54757690429688,
                52.13043975830078
            ],
            [
                -72.63135528564453,
                53.013763427734375
            ],
            [
                -67.79861831665039,
                54.27446746826172
            ],
            [
                -63.10877227783203,
                55.98931884765625
            ],
            [
                -58.66926574707031,
                58.271568298339844
            ],
            [
                -54.683128356933594,
                61.26948547363281
            ],
            [
                -51.50980758666992,
                65.10822296142578
            ],
            [
                -48.71994400024414,
                68.03173065185547
            ],
            [
                -44.02956008911133,
                66.31305694580078
            ],
            [
                -39.434608459472656,
                64.35325622558594
            ],
            [
                -34.94796371459961,
                62.15656280517578
            ],
            [
                -30.582305908203125,
                59.728721618652344
            ],
            [
                -26.350040435791016,
                57.07501983642578
            ],
            [
                -22.26431655883789,
                54.20097351074219
            ],
            [
                -18.337894439697266,
                51.11271667480469
            ],
            [
                -14.584300994873047,
                47.81652069091797
            ],
            [
                -11.017578125,
                44.31916046142578
            ],
            [
                -7.6526947021484375,
                42.46894836425781
            ],
            [
                -4.36865234375,
                46.23382568359375
            ],
            [
                -1.0845413208007812,
                49.99879455566406
            ],
            [
                2.1995697021484375,
                53.763763427734375
            ],
            [
                5.483634948730469,
                57.528663635253906
            ],
            [
                8.767745971679688,
                61.29363250732422
            ],
            [
                12.051788330078125,
                65.05853271484375
            ],
            [
                15.335899353027344,
                68.82347869873047
            ],
            [
                18.620010375976562,
                72.58844757080078
            ],
            [
                23.428817749023438,
                73
            ],
            [
                28.424850463867188,
                73
            ],
            [
                33.42079162597656,
                73
            ],
            [
                38.41682434082031,
                73
            ],
            [
                43.41285705566406,
                73
            ],
            [
                48.40879821777344,
                73
            ],
            [
                53.40483093261719,
                73
            ],
            [
                55.19969940185547,
                69.44683837890625
            ],
            [
                54.400421142578125,
                64.54396057128906
            ],
            [
                51.70014190673828,
                60.38746643066406
            ],
            [
                47.61363983154297,
                57.55230712890625
            ],
            [
                42.91899871826172,
                55.86943054199219
            ],
            [
                38.00426483154297,
                54.99420928955078
            ],
            [
                33.0189208984375,
                54.70549774169922
            ],
            [
                29.052398681640625,
                53.59825897216797
            ],
            [
                28.142227172851562,
                48.68592834472656
            ],
            [
                27.232032775878906,
                43.77350616455078
            ],
            [
                26.321861267089844,
                38.861175537109375
            ],
            [
                29.4373779296875,
                35.58697509765625
            ],
            [
                33.24688720703125,
                32.35795593261719
            ],
            [
                36.701698303222656,
                28.752334594726562
            ],
            [
                39.747474670410156,
                24.7952880859375
            ],
            [
                42.343544006347656,
                20.529754638671875
            ],
            [
                44.466285705566406,
                16.009681701660156
            ],
            [
                46.111122131347656,
                11.294509887695312
            ],
            [
                47.28917694091797,
                6.441322326660156
            ],
            [
                48.020591735839844,
                1.50079345703125
            ],
            [
                48.32814025878906,
                -3.4842071533203125
            ],
            [
                48.22901153564453,
                -8.477893829345703
            ],
            [
                47.71986389160156,
                -13.446357727050781
            ],
            [
                49.34126281738281,
                -16.30632781982422
            ],
            [
                54.31317138671875,
                -16.77594757080078
            ],
            [
                59.21705627441406,
                -17.720943450927734
            ],
            [
                64.01254272460938,
                -19.115840911865234
            ],
            [
                68.6585693359375,
                -20.947834014892578
            ],
            [
                73.10636138916016,
                -23.21874237060547
            ],
            [
                77.28617858886719,
                -25.9498291015625
            ],
            [
                81.08451843261719,
                -29.188884735107422
            ],
            [
                84.2888412475586,
                -33.01132583618164
            ],
            [
                86.46603393554688,
                -37.486915588378906
            ],
            [
                86.8321762084961,
                -42.426231384277344
            ],
            [
                48.592018127441406,
                -49.37241744995117
            ],
            [
                45.06316375732422,
                -52.69549560546875
            ],
            [
                45.23139190673828,
                -57.53998565673828
            ],
            [
                48.982147216796875,
                -60.60990905761719
            ],
            [
                53.762939453125,
                -59.812049865722656
            ],
            [
                56.31620788574219,
                -55.69286346435547
            ],
            [
                54.90599822998047,
                -51.05604934692383
            ]
        ]
    },
    {
        name: "Pigeon",
        data: [
            [
                94.63899230957031,
                -100.82599830627441
            ],
            [
                97.5463638305664,
                -99.60297393798828
            ],
            [
                100.4537582397461,
                -98.37995529174805
            ],
            [
                103.36112976074219,
                -97.15693092346191
            ],
            [
                106.26850128173828,
                -95.93391227722168
            ],
            [
                109.17587280273438,
                -94.71088790893555
            ],
            [
                112.08326721191406,
                -93.48786926269531
            ],
            [
                114.99063873291016,
                -92.26484489440918
            ],
            [
                117.89801025390625,
                -91.04182052612305
            ],
            [
                119.02971649169922,
                -91.34638214111328
            ],
            [
                117.38611602783203,
                -94.03845596313477
            ],
            [
                115.74253845214844,
                -96.73052978515625
            ],
            [
                114.09893798828125,
                -99.42260360717773
            ],
            [
                112.45536041259766,
                -102.11467170715332
            ],
            [
                110.81175994873047,
                -104.8067455291748
            ],
            [
                109.16818237304688,
                -107.49881362915039
            ],
            [
                107.52460479736328,
                -110.19088745117188
            ],
            [
                105.8810043334961,
                -112.88295555114746
            ],
            [
                104.2374267578125,
                -115.57502937316895
            ],
            [
                102.59382629394531,
                -118.26710319519043
            ],
            [
                100.95024871826172,
                -120.95917129516602
            ],
            [
                99.520263671875,
                -123.7431640625
            ],
            [
                98.45333099365234,
                -126.70908641815186
            ],
            [
                97.01803588867188,
                -129.51535511016846
            ],
            [
                95.23909759521484,
                -132.11739253997803
            ],
            [
                93.14613342285156,
                -134.4742603302002
            ],
            [
                90.77274322509766,
                -136.5484790802002
            ],
            [
                88.15612030029297,
                -138.30590534210205
            ],
            [
                85.3372802734375,
                -139.7162322998047
            ],
            [
                82.36128997802734,
                -140.75465202331543
            ],
            [
                79.27680969238281,
                -141.40352058410645
            ],
            [
                76.13485717773438,
                -141.65531063079834
            ],
            [
                72.986083984375,
                -141.51144695281982
            ],
            [
                69.88079833984375,
                -140.97079372406006
            ],
            [
                66.86988067626953,
                -140.0384349822998
            ],
            [
                64.00260925292969,
                -138.72931098937988
            ],
            [
                61.32496643066406,
                -137.06637859344482
            ],
            [
                58.878997802734375,
                -135.07829093933105
            ],
            [
                56.70306396484375,
                -132.79780101776123
            ],
            [
                54.83213806152344,
                -130.26109218597412
            ],
            [
                53.2974853515625,
                -127.50793266296387
            ],
            [
                52.125953674316406,
                -124.5817756652832
            ],
            [
                51.33759307861328,
                -121.52997970581055
            ],
            [
                50.94414520263672,
                -118.40261840820312
            ],
            [
                50.95366668701172,
                -115.25085258483887
            ],
            [
                51.046409606933594,
                -112.53880882263184
            ],
            [
                51.56755065917969,
                -109.42883110046387
            ],
            [
                51.867706298828125,
                -106.28960800170898
            ],
            [
                51.95543670654297,
                -103.13731575012207
            ],
            [
                51.81730651855469,
                -99.98694038391113
            ],
            [
                51.4320068359375,
                -96.85733604431152
            ],
            [
                50.77289581298828,
                -93.77400016784668
            ],
            [
                49.812232971191406,
                -90.77124214172363
            ],
            [
                48.52598571777344,
                -87.89325332641602
            ],
            [
                46.90065002441406,
                -85.19256210327148
            ],
            [
                45.00585174560547,
                -82.67157173156738
            ],
            [
                43.00929260253906,
                -80.22991752624512
            ],
            [
                40.95484924316406,
                -77.83668899536133
            ],
            [
                38.860992431640625,
                -75.47783851623535
            ],
            [
                36.73809051513672,
                -73.14506912231445
            ],
            [
                34.5928955078125,
                -70.83279037475586
            ],
            [
                32.429527282714844,
                -68.53749465942383
            ],
            [
                30.25098419189453,
                -66.25658416748047
            ],
            [
                28.05950927734375,
                -63.98809051513672
            ],
            [
                25.856658935546875,
                -61.73064041137695
            ],
            [
                23.643646240234375,
                -59.483158111572266
            ],
            [
                21.42105484008789,
                -57.245140075683594
            ],
            [
                19.190692901611328,
                -55.014892578125
            ],
            [
                16.952125549316406,
                -52.792850494384766
            ],
            [
                14.705764770507812,
                -50.57865905761719
            ],
            [
                12.451427459716797,
                -48.37262725830078
            ],
            [
                10.18771743774414,
                -46.176231384277344
            ],
            [
                7.558815002441406,
                -44.43766784667969
            ],
            [
                4.913810729980469,
                -42.719383239746094
            ],
            [
                2.2688064575195312,
                -41.0010986328125
            ],
            [
                -0.376220703125,
                -39.28280258178711
            ],
            [
                -3.0212478637695312,
                -37.56450653076172
            ],
            [
                -5.666252136230469,
                -35.846221923828125
            ],
            [
                -8.311279296875,
                -34.12793731689453
            ],
            [
                -10.956283569335938,
                -32.40964126586914
            ],
            [
                -13.601287841796875,
                -30.691356658935547
            ],
            [
                -16.246315002441406,
                -28.973060607910156
            ],
            [
                -18.891342163085938,
                -27.254776000976562
            ],
            [
                -21.53636932373047,
                -25.536479949951172
            ],
            [
                -24.181373596191406,
                -23.818195343017578
            ],
            [
                -26.826377868652344,
                -22.099899291992188
            ],
            [
                -29.471405029296875,
                -20.381614685058594
            ],
            [
                -32.11640930175781,
                -18.663330078125
            ],
            [
                -34.761436462402344,
                -16.94503402709961
            ],
            [
                -37.406463623046875,
                -15.226737976074219
            ],
            [
                -40.05144500732422,
                -13.508453369140625
            ],
            [
                -42.69647216796875,
                -11.790168762207031
            ],
            [
                -45.34149932861328,
                -10.07187271118164
            ],
            [
                -47.98650360107422,
                -8.353599548339844
            ],
            [
                -50.63153076171875,
                -6.635292053222656
            ],
            [
                -53.276546478271484,
                -4.9170074462890625
            ],
            [
                -55.92156219482422,
                -3.198711395263672
            ],
            [
                -58.566566467285156,
                -1.480438232421875
            ],
            [
                -61.21159362792969,
                0.2378692626953125
            ],
            [
                -63.85662078857422,
                1.9561538696289062
            ],
            [
                -66.50162506103516,
                3.6744384765625
            ],
            [
                -69.14664077758789,
                5.392734527587891
            ],
            [
                -71.79165649414062,
                7.111030578613281
            ],
            [
                -74.43666648864746,
                8.829303741455078
            ],
            [
                -77.0816879272461,
                10.547599792480469
            ],
            [
                -79.72670936584473,
                12.26589584350586
            ],
            [
                -82.37170791625977,
                13.984169006347656
            ],
            [
                -85.0167293548584,
                15.702465057373047
            ],
            [
                -87.66175651550293,
                17.420761108398438
            ],
            [
                -90.30677795410156,
                19.139057159423828
            ],
            [
                -92.9517822265625,
                20.857330322265625
            ],
            [
                -95.59679794311523,
                22.575637817382812
            ],
            [
                -98.24182510375977,
                24.293922424316406
            ],
            [
                -100.8868293762207,
                26.01220703125
            ],
            [
                -103.53184509277344,
                27.730491638183594
            ],
            [
                -106.17687225341797,
                29.44879913330078
            ],
            [
                -108.82187080383301,
                31.167083740234375
            ],
            [
                -111.46689224243164,
                32.88536834716797
            ],
            [
                -114.11191368103027,
                34.60365295410156
            ],
            [
                -116.7569351196289,
                36.32196044921875
            ],
            [
                -119.40193939208984,
                38.040245056152344
            ],
            [
                -122.04696083068848,
                39.75852966308594
            ],
            [
                -124.69196510314941,
                41.47681427001953
            ],
            [
                -127.33700656890869,
                43.19512176513672
            ],
            [
                -129.98200798034668,
                44.91340637207031
            ],
            [
                -132.62701225280762,
                46.63166809082031
            ],
            [
                -135.2720537185669,
                48.3499755859375
            ],
            [
                -137.9005241394043,
                50.092933654785156
            ],
            [
                -140.4962558746338,
                51.88475799560547
            ],
            [
                -143.09202766418457,
                53.67662811279297
            ],
            [
                -145.687762260437,
                55.468475341796875
            ],
            [
                -148.28349685668945,
                57.26032257080078
            ],
            [
                -150.87926721572876,
                59.05219268798828
            ],
            [
                -153.47500038146973,
                60.844017028808594
            ],
            [
                -156.07073497772217,
                62.6358642578125
            ],
            [
                -158.66650676727295,
                64.427734375
            ],
            [
                -157.56171989440918,
                64.749267578125
            ],
            [
                -154.4440574645996,
                64.27104187011719
            ],
            [
                -151.32634353637695,
                63.792816162109375
            ],
            [
                -148.20868110656738,
                63.314613342285156
            ],
            [
                -145.09097003936768,
                62.836387634277344
            ],
            [
                -141.97330474853516,
                62.35816192626953
            ],
            [
                -138.85563945770264,
                61.87993621826172
            ],
            [
                -135.73792839050293,
                61.401710510253906
            ],
            [
                -132.6202630996704,
                60.923484802246094
            ],
            [
                -129.50260066986084,
                60.44525909423828
            ],
            [
                -126.38488960266113,
                59.96703338623047
            ],
            [
                -123.26722431182861,
                59.488807678222656
            ],
            [
                -120.1495590209961,
                59.01060485839844
            ],
            [
                -117.03185081481934,
                58.53235626220703
            ],
            [
                -113.91418266296387,
                58.05415344238281
            ],
            [
                -110.7965202331543,
                57.575927734375
            ],
            [
                -107.67880630493164,
                57.09770202636719
            ],
            [
                -104.56370162963867,
                56.88806915283203
            ],
            [
                -101.45383262634277,
                57.414634704589844
            ],
            [
                -98.34108543395996,
                57.9241943359375
            ],
            [
                -95.22568321228027,
                58.41688537597656
            ],
            [
                -92.10770034790039,
                58.893211364746094
            ],
            [
                -88.98730850219727,
                59.35337829589844
            ],
            [
                -85.86446189880371,
                59.796424865722656
            ],
            [
                -82.73932647705078,
                60.22331237792969
            ],
            [
                -79.61195373535156,
                60.63328552246094
            ],
            [
                -76.48238945007324,
                61.026092529296875
            ],
            [
                -73.35067367553711,
                61.401893615722656
            ],
            [
                -70.21698379516602,
                61.76025390625
            ],
            [
                -67.08130264282227,
                62.10087585449219
            ],
            [
                -63.94359588623047,
                62.42295837402344
            ],
            [
                -60.80413818359375,
                62.72636413574219
            ],
            [
                -57.66281509399414,
                63.01074981689453
            ],
            [
                -54.51980972290039,
                63.275611877441406
            ],
            [
                -51.37523651123047,
                63.520721435546875
            ],
            [
                -48.22907257080078,
                63.74488830566406
            ],
            [
                -45.081443786621094,
                63.94774627685547
            ],
            [
                -41.93254470825195,
                64.12867736816406
            ],
            [
                -38.782386779785156,
                64.28690338134766
            ],
            [
                -35.63109588623047,
                64.42173767089844
            ],
            [
                -32.478912353515625,
                64.53228759765625
            ],
            [
                -29.325939178466797,
                64.61747741699219
            ],
            [
                -26.172348022460938,
                64.67655181884766
            ],
            [
                -23.018367767333984,
                64.70848083496094
            ],
            [
                -19.864295959472656,
                64.71214294433594
            ],
            [
                -16.710224151611328,
                64.68632507324219
            ],
            [
                -13.676006317138672,
                65.08064270019531
            ],
            [
                -10.964179992675781,
                66.69139862060547
            ],
            [
                -8.2406005859375,
                68.28228759765625
            ],
            [
                -5.501605987548828,
                69.84637451171875
            ],
            [
                -2.7401695251464844,
                71.3703842163086
            ],
            [
                0.05927276611328125,
                72.82323455810547
            ],
            [
                2.1928749084472656,
                74.7644271850586
            ],
            [
                3.0308456420898438,
                77.80525970458984
            ],
            [
                3.868816375732422,
                80.84602355957031
            ],
            [
                4.706775665283203,
                83.88681030273438
            ],
            [
                5.544757843017578,
                86.92764282226562
            ],
            [
                3.963916778564453,
                88.12602233886719
            ],
            [
                0.8097877502441406,
                88.12602233886719
            ],
            [
                -2.3443870544433594,
                88.12602233886719
            ],
            [
                -5.498516082763672,
                88.12602233886719
            ],
            [
                -8.652645111083984,
                88.12602233886719
            ],
            [
                -11.387004852294922,
                88.54583740234375
            ],
            [
                -11.387004852294922,
                91.69996643066406
            ],
            [
                -11.387004852294922,
                94.85409545898438
            ],
            [
                -9.559738159179688,
                96.18101501464844
            ],
            [
                -6.405609130859375,
                96.18101501464844
            ],
            [
                -3.2514801025390625,
                96.18101501464844
            ],
            [
                -0.0973052978515625,
                96.18101501464844
            ],
            [
                3.05682373046875,
                96.18101501464844
            ],
            [
                6.2109527587890625,
                96.18101501464844
            ],
            [
                9.365127563476562,
                96.18101501464844
            ],
            [
                12.519256591796875,
                96.18101501464844
            ],
            [
                15.673385620117188,
                96.18101501464844
            ],
            [
                18.827560424804688,
                96.18101501464844
            ],
            [
                21.981689453125,
                96.18101501464844
            ],
            [
                25.135818481445312,
                96.18101501464844
            ],
            [
                28.289993286132812,
                96.18101501464844
            ],
            [
                31.444122314453125,
                96.18101501464844
            ],
            [
                34.598297119140625,
                96.18101501464844
            ],
            [
                36.933990478515625,
                95.36257934570312
            ],
            [
                36.933990478515625,
                92.20845031738281
            ],
            [
                36.933990478515625,
                89.05427551269531
            ],
            [
                34.70811462402344,
                88.12602233886719
            ],
            [
                31.553985595703125,
                88.12602233886719
            ],
            [
                28.399810791015625,
                88.12602233886719
            ],
            [
                25.245681762695312,
                88.12602233886719
            ],
            [
                22.091552734375,
                88.12602233886719
            ],
            [
                18.937366485595703,
                88.12602233886719
            ],
            [
                15.78323745727539,
                88.12602233886719
            ],
            [
                13.8045654296875,
                86.58267211914062
            ],
            [
                12.966354370117188,
                83.54190826416016
            ],
            [
                12.128154754638672,
                80.50119018554688
            ],
            [
                11.289955139160156,
                77.4604721069336
            ],
            [
                10.451744079589844,
                74.41973114013672
            ],
            [
                9.613544464111328,
                71.37901306152344
            ],
            [
                10.894962310791016,
                68.96630096435547
            ],
            [
                13.208305358886719,
                66.82225036621094
            ],
            [
                15.482269287109375,
                64.63656616210938
            ],
            [
                17.72683334350586,
                62.42057800292969
            ],
            [
                20.640338897705078,
                61.516700744628906
            ],
            [
                23.741905212402344,
                60.943511962890625
            ],
            [
                26.831443786621094,
                60.308502197265625
            ],
            [
                29.906402587890625,
                59.606658935546875
            ],
            [
                32.96430969238281,
                58.8338623046875
            ],
            [
                36.00196075439453,
                57.98480224609375
            ],
            [
                39.01544189453125,
                57.053871154785156
            ],
            [
                42.000335693359375,
                56.03486633300781
            ],
            [
                44.95112609863281,
                54.921287536621094
            ],
            [
                47.86163330078125,
                53.706016540527344
            ],
            [
                50.72416687011719,
                52.38184356689453
            ],
            [
                53.529205322265625,
                50.94029998779297
            ],
            [
                56.266700744628906,
                49.374107360839844
            ],
            [
                58.92390441894531,
                47.67523193359375
            ],
            [
                61.4859619140625,
                45.836395263671875
            ],
            [
                63.936851501464844,
                43.85173797607422
            ],
            [
                66.25823974609375,
                41.717185974121094
            ],
            [
                68.43183898925781,
                39.432464599609375
            ],
            [
                70.4899673461914,
                37.04252624511719
            ],
            [
                72.45320129394531,
                34.574127197265625
            ],
            [
                74.31742095947266,
                32.03022003173828
            ],
            [
                76.07896423339844,
                29.414077758789062
            ],
            [
                77.73460388183594,
                26.72954559326172
            ],
            [
                79.28168487548828,
                23.981292724609375
            ],
            [
                80.71842193603516,
                21.173519134521484
            ],
            [
                82.04316711425781,
                18.311328887939453
            ],
            [
                83.25603485107422,
                15.399894714355469
            ],
            [
                84.35645294189453,
                12.444206237792969
            ],
            [
                85.3457260131836,
                9.449344635009766
            ],
            [
                86.22442626953125,
                6.420345306396484
            ],
            [
                86.99491119384766,
                3.3618545532226562
            ],
            [
                87.6590347290039,
                0.27858734130859375
            ],
            [
                88.21910858154297,
                -2.8251991271972656
            ],
            [
                88.67817687988281,
                -5.945705413818359
            ],
            [
                89.03910064697266,
                -9.078983306884766
            ],
            [
                89.5780029296875,
                -11.630237579345703
            ],
            [
                89.5780029296875,
                -14.784412384033203
            ],
            [
                89.5780029296875,
                -17.938587188720703
            ],
            [
                89.5780029296875,
                -21.092670440673828
            ],
            [
                89.5780029296875,
                -24.246845245361328
            ],
            [
                89.5780029296875,
                -27.401020050048828
            ],
            [
                89.5780029296875,
                -30.555194854736328
            ],
            [
                89.5780029296875,
                -33.70927810668945
            ],
            [
                89.5780029296875,
                -36.86345291137695
            ],
            [
                89.5780029296875,
                -40.01762771606445
            ],
            [
                89.5780029296875,
                -43.17171096801758
            ],
            [
                89.5780029296875,
                -46.32588577270508
            ],
            [
                89.5780029296875,
                -49.48006057739258
            ],
            [
                89.5780029296875,
                -52.6341438293457
            ],
            [
                89.5780029296875,
                -55.7883186340332
            ],
            [
                89.5780029296875,
                -58.9424934387207
            ],
            [
                89.5780029296875,
                -62.09657669067383
            ],
            [
                89.5780029296875,
                -65.25075149536133
            ],
            [
                89.5780029296875,
                -68.40492630004883
            ],
            [
                89.5780029296875,
                -71.55900955200195
            ],
            [
                89.5780029296875,
                -74.71318435668945
            ],
            [
                89.5780029296875,
                -77.86735916137695
            ],
            [
                89.5780029296875,
                -81.02144241333008
            ],
            [
                89.5780029296875,
                -84.17561721801758
            ],
            [
                89.5780029296875,
                -87.32979202270508
            ],
            [
                89.5780029296875,
                -90.4838752746582
            ],
            [
                89.5780029296875,
                -93.6380500793457
            ],
            [
                90.00782012939453,
                -96.56732559204102
            ],
            [
                92.45742797851562,
                -98.55084419250488
            ]
        ]
    }
]

// Define global variables
let display = {
    center: {
        x: 0,
        y: 75
    },
    zoom: 3
};
let t = 0;
let cycles = [];
let path = [];
let draw_guides = true;
let selectedImageIndex = 0;

function world2screen(point) {
    // Calculate pixel scalar
    const unitsPerPixel = 1 / display.zoom;

    // Caculate world distance from the center
    const xFromCenter = point.x - display.center.x;
    const yFromCenter = point.y - display.center.y;

    // Calculate screen distance from center
    const screenXFromCenter = xFromCenter / unitsPerPixel;
    const screenYFromCenter = yFromCenter / unitsPerPixel;

    return createVector(
        windowWidth / 2 + screenXFromCenter,
        windowHeight / 2 - screenYFromCenter
    );
}

function drawVector(startPoint, endPoint) {
    // Convert coordinates from world space to screen space
    const startScreenPoint = world2screen(startPoint);
    const endScreenPoint = world2screen(endPoint);

    // Calculate the radius of the circle from our position vectors
    const radius = p5.Vector.sub(
        startScreenPoint,
        endScreenPoint
    ).mag();

    // Draw the shapes
    noFill();
    stroke(255, 100);
    ellipse(
        startScreenPoint.x,
        startScreenPoint.y,
        radius * 2
    );
    stroke(255);
    line(
        startScreenPoint.x,
        startScreenPoint.y,
        endScreenPoint.x,
        endScreenPoint.y
    );
}

function drawCycles(cycles) {
    let lastEnd = createVector(0, 0);
    let end;
    for (let i = 0; i < cycles.length; i++) {
        const cycle = cycles[i];
        const endX = cycle.amp * cos(cycle.freq * t + cycle.phase);
        const endY = cycle.amp * -sin(cycle.freq * t + cycle.phase);
        end = p5.Vector.add(
            createVector(endX, endY), 
            lastEnd
        );

        if (draw_guides)
            drawVector(lastEnd, end);
        lastEnd = end;
    }
    return end;
}

function dft(x) {
    let X = [];
    const N = x.length;

    for(let k = 0; k < N; k++) {
        let sum =  new Complex(0, 0);
        for (let n = 0; n < N; n++) {
            const xn = x[n];
            const phi = (TWO_PI * k * n) / N;
            const z = new Complex(cos(phi), -sin(phi));

            sum.add(xn.mult(z));
        }

        sum.re = sum.re / N;
        sum.im = sum.im / N;
        X[k] = sum;
    }

    return X;
}

function getCycles(image) {
    // Convert coordinates to complex numbers
    const x = [];
    for (let i = 0; i < image.length; i++) {
        x[i] = new Complex(image[i][0], image[i][1]);
    }

    // Perform the DFT
    const dftRes = dft(x);

    // Calculate properties from DFT data
    const cycles = [];
    for (let i = 0; i < image.length; i++) {
        const freq = i;
        const amp = sqrt(
            dftRes[i].re * dftRes[i].re
          + dftRes[i].im * dftRes[i].im
        );
        const phase = atan2(dftRes[i].im, dftRes[i].re);
        cycles[i] = new Cycle(freq, amp, phase);
    }

    return cycles.sort((a, b) => b.amp - a.amp);
}

function resetFourier() {
    t = 0;
    path = [];
    const data = window.images[selectedImageIndex].data;
    cycles = getCycles(data);
    let asciiMath = "";
    asciiMath += "f(t) =<br>";
    for (let i = 0; i < cycles.length; i++) {
        let cycle = cycles[i];
        let amp = cycle.amp.toFixed(5);
        let freq = cycle.freq;
        let phase = cycle.phase.toFixed(5);
        let sign = i === 0 ? "" : " + ";
        // Determine sign for phase inside functions
        let phaseSign = phase >= 0 ? "+" : "-";
        let absPhase = Math.abs(phase);
        asciiMath += `${sign}${amp}(cos(${freq}t ${phaseSign} ${absPhase}) + i sin(${freq}t ${phaseSign} ${absPhase}))<br>`;
    }
    let equationDiv = document.getElementById("equation");
    if (equationDiv) {
        equationDiv.innerHTML = asciiMath;
    }
    background(0);
}

function setupGuideToggle() {
    const btn = document.createElement('button');
    btn.id = 'toggleGuidesBtn';
    btn.textContent = draw_guides ? 'Hide Guides' : 'Show Guides';
    btn.onclick = function () {
        draw_guides = !draw_guides;
        btn.textContent = draw_guides ? 'Hide Guides' : 'Show Guides';
    };
    const controls = document.getElementById('controls');
    if (controls) {
        controls.appendChild(btn);
    }
}

function setupImageSelector() {
    const selector = document.getElementById('imageSelector');
    if (!selector) return;
    selector.innerHTML = '';
    images.forEach((img, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = img.name;
        selector.appendChild(opt);
    });
    selector.value = selectedImageIndex;
    selector.onchange = function () {
        selectedImageIndex = parseInt(this.value);
        resetFourier();
    };
}

function setup() {
    createCanvas(windowWidth, windowHeight);
    display.zoom = windowWidth > 600? 3 : 1
    setupImageSelector();
    setupGuideToggle();
    resetFourier();
}

function draw() {
    background(0);
    let v = drawCycles(cycles);
    path.unshift(world2screen(v));

    beginShape();
    noFill();
    for (let i = 0; i < path.length; i++) {
        vertex(path[i].x, path[i].y);
    }
    endShape();

    const dt = TWO_PI / cycles.length;
    t += dt;
    if (t > TWO_PI) {
        t = 0;
        path = [];
    }
}
